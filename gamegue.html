<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Güegüense: Aventura Cultural - cultunica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }
        
        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: linear-gradient(180deg, #87CEEB 0%, #98FB98 30%, #228B22 100%);
            overflow: hidden;
        }
        
        .game-canvas {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
        }
        
        .character {
            position: absolute;
            width: 120px;
            height: 160px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
        }
        
        .gueguense {
            background: linear-gradient(45deg, #8B4513 0%, #D2691E  50%, #CD853F 100%);
            border-radius: 50% 50% 20% 20%;
            border: 4px solid #654321;
            animation: float 3s ease-in-out infinite;
        }
        
        .gueguense::before {
            content: '🎭';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 60px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .gueguense::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 40px;
            background: linear-gradient(45deg, #FF6B35 0%, #F7931E 100%);
            border-radius: 50%;
            border: 3px solid #D2691E;
        }
        
        .enemy {
            background: linear-gradient(45deg, #2C3E50 0%, #34495E 50%, #5D6D7E 100%);
            border-radius: 50% 50% 20% 20%;
            border: 4px solid #1B2631;
            animation: enemyFloat 2s ease-in-out infinite;
        }
        
        .enemy::before {
            content: '👹';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 50px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .collectible {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            animation: spin 2s linear infinite, collectibleFloat 3s ease-in-out infinite;
            z-index: 5;
            filter: drop-shadow(0 5px 15px rgba(255,215,0,0.5));
        }
        
        .corn {
            background: radial-gradient(circle, #FFD700 0%, #FFA500 70%, #FF8C00 100%);
            border: 3px solid #DAA520;
        }
        
        .corn::before {
            content: '🌽';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
        }
        
        .mask {
            background: radial-gradient(circle, #8B4513 0%, #A0522D 70%, #CD853F 100%);
            border: 3px solid #654321;
        }
        
        .mask::before {
            content: '🎭';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 25px;
        }
        
        .projectile {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            z-index: 8;
            box-shadow: 0 0 20px #FFD700, 0 0 40px #FFA500;
            animation: projectileGlow 0.5s ease-in-out infinite alternate;
        }
        
        .projectile::before {
            content: '✨';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
        }
        
        .explosion {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, #FF4500 0%, #FF6347 30%, #FFD700 60%, transparent 100%);
            animation: explode 0.6s ease-out forwards;
            z-index: 15;
        }
        
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #FFD700;
            border-radius: 50%;
            animation: particleFloat 2s ease-out forwards;
        }
        
        .hud {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 20;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);
            padding: 20px;
            color: white;
        }
        
        .hud-item {
            display: inline-flex;
            align-items: center;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 10px 20px;
            margin-right: 15px;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .health-bar {
            width: 200px;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF4444 0%, #FF6B6B 50%, #4ECDC4 100%);
            transition: width 0.3s ease;
            border-radius: 8px;
        }
        
        .power-up {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(circle, #9B59B6 0%, #8E44AD 70%, #663399 100%);
            border: 4px solid #7D3C98;
            animation: powerUpPulse 1.5s ease-in-out infinite, collectibleFloat 3s ease-in-out infinite;
            z-index: 6;
            filter: drop-shadow(0 8px 20px rgba(155,89,182,0.6));
        }
        
        .power-up::before {
            content: '⚡';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 35px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .background-element {
            position: absolute;
            opacity: 0.3;
            animation: backgroundFloat 8s ease-in-out infinite;
        }
        
        .volcano {
            width: 200px;
            height: 150px;
            background: linear-gradient(45deg, #8B4513 0%, #A0522D 50%, #CD853F 100%);
            clip-path: polygon(20% 100%, 50% 0%, 80% 100%);
            right: 100px;
            bottom: 0;
        }
        
        .volcano::before {
            content: '🌋';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
        }
        
        .tree {
            width: 80px;
            height: 120px;
            left: 150px;
            bottom: 0;
        }
        
        .tree::before {
            content: '🌴';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            font-size: 60px;
        }
        
        .cloud {
            width: 120px;
            height: 60px;
            background: rgba(255,255,255,0.8);
            border-radius: 60px;
            animation: cloudFloat 15s linear infinite;
        }
        
        .cloud::before,
        .cloud::after {
            content: '';
            position: absolute;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
        }
        
        .cloud::before {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 10px;
        }
        
        .cloud::after {
            width: 60px;
            height: 60px;
            top: -35px;
            right: 15px;
        }
        
        .game-over-screen,
        .start-screen,
        .pause-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50;
            backdrop-filter: blur(10px);
        }
        
        .screen-title {
            font-family: 'Cinzel', serif;
            font-size: 4rem;
            font-weight: 700;
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            margin-bottom: 2rem;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }
        
        .screen-subtitle {
            font-size: 1.5rem;
            color: #FFF;
            text-align: center;
            margin-bottom: 3rem;
            max-width: 600px;
            line-height: 1.6;
        }
        
        .game-button {
            background: linear-gradient(45deg, #FF6B35 0%, #F7931E 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 8px 25px rgba(255,107,53,0.4);
        }
        
        .game-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(255,107,53,0.6);
        }
        
        .controls-info {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.8);
            text-align: center;
            font-size: 0.9rem;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes enemyFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-8px) rotate(5deg); }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes collectibleFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-15px) scale(1.1); }
        }
        
        @keyframes projectileGlow {
            0% { box-shadow: 0 0 20px #FFD700, 0 0 40px #FFA500; }
            100% { box-shadow: 0 0 30px #FFD700, 0 0 60px #FFA500, 0 0 80px #FF6347; }
        }
        
        @keyframes explode {
            0% { 
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1.2) rotate(180deg);
                opacity: 0.8;
            }
            100% { 
                transform: scale(2) rotate(360deg);
                opacity: 0;
            }
        }
        
        @keyframes particleFloat {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--random-x, 50px), var(--random-y, -100px)) scale(0);
                opacity: 0;
            }
        }
        
        @keyframes powerUpPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 20px rgba(155,89,182,0.6);
            }
            50% { 
                transform: scale(1.2);
                box-shadow: 0 0 40px rgba(155,89,182,0.9), 0 0 60px rgba(155,89,182,0.6);
            }
        }
        
        @keyframes backgroundFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes cloudFloat {
            0% { transform: translateX(-150px); }
            100% { transform: translateX(calc(100vw + 150px)); }
        }
        
        @keyframes titleGlow {
            0% { text-shadow: 3px 3px 6px rgba(0,0,0,0.8), 0 0 30px #FFD700; }
            100% { text-shadow: 3px 3px 6px rgba(0,0,0,0.8), 0 0 50px #FFD700, 0 0 70px #FFA500; }
        }
        
        .combo-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            animation: comboShow 1s ease-out forwards;
            z-index: 25;
            pointer-events: none;
        }
        
        @keyframes comboShow {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) translateY(-50px);
                opacity: 0;
            }
        }
        
        .mobile-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            z-index: 30;
        }
        
        .mobile-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            margin: 0 10px;
            color: white;
            font-size: 1.5rem;
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mobile-btn:active {
            transform: scale(0.9);
            background: rgba(255,255,255,0.4);
        }
        
        @media (max-width: 768px) {
            .mobile-controls {
                display: flex;
            }
            
            .screen-title {
                font-size: 2.5rem;
            }
            
            .screen-subtitle {
                font-size: 1.2rem;
                padding: 0 20px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container" id="gameContainer">
        <!-- Background Elements -->
        <div class="background-element volcano"></div>
        <div class="background-element tree"></div>
        <div class="cloud" style="top: 10%; animation-delay: 0s;"></div>
        <div class="cloud" style="top: 20%; animation-delay: -5s;"></div>
        <div class="cloud" style="top: 15%; animation-delay: -10s;"></div>
        
        <!-- Game Canvas -->
        <canvas class="game-canvas" id="gameCanvas"></canvas>
        
        <!-- HUD -->
        <div class="hud">
            <div class="hud-item">
                <i class="fas fa-heart mr-2 text-red-400"></i>
                <div class="health-bar">
                    <div class="health-fill" id="healthFill" style="width: 100%;"></div>
                </div>
            </div>
            <div class="hud-item">
                <i class="fas fa-star mr-2 text-yellow-400"></i>
                <span id="score">0</span>
            </div>
            <div class="hud-item">
                <i class="fas fa-trophy mr-2 text-orange-400"></i>
                <span>Nivel <span id="level">1</span></span>
            </div>
            <div class="hud-item">
                <i class="fas fa-fire mr-2 text-red-500"></i>
                <span>Combo: <span id="combo">0</span></span>
            </div>
        </div>
        
        <!-- Start Screen -->
        <div class="start-screen" id="startScreen">
           <div id="back-arrow-start" class="fixed top-6 left-6 z-50">
    <button class="bg-white/80 hover:bg-blue-100 text-blue-700 rounded-full p-3 shadow-lg transition-all text-xl" title="Volver a Juegos" onclick="goBackToGames()">
        <i class="fas fa-arrow-left"></i>
    </button>
</div> 
            <h1 class="screen-title">EL GÜEGÜENSE</h1>
            <p class="screen-subtitle">
                🎭 Aventura Cultural Nicaragüense 🇳🇮<br>
                Ayuda al Güegüense a recolectar máscaras tradicionales y maíz sagrado<br>
                mientras evita a los espíritus malignos del folclore nicaragüense
            </p>
            <button class="game-button" onclick="startGame()">
                <i class="fas fa-play mr-2"></i>Comenzar Aventura
            </button>
            <button class="game-button" onclick="showInstructions()">
                <i class="fas fa-question-circle mr-2"></i>Instrucciones
            </button>
            <div class="controls-info">
                <p><strong>Controles:</strong></p>
                <p>🖱️ Mouse: Mover el Güegüense | 🖱️ Click: Disparar magia | ⏸️ ESC: Pausa</p>
                <p>📱 Móvil: Toca la pantalla para mover y disparar</p>
            </div>
        </div>
        
        <!-- Game Over Screen -->
        <div class="game-over-screen hidden" id="gameOverScreen">
            <div id="back-arrow-gameover" class="fixed top-6 left-6 z-50">
    <button class="bg-white/80 hover:bg-blue-100 text-blue-700 rounded-full p-3 shadow-lg transition-all text-xl" title="Volver a Juegos" onclick="goBackToGames()">
        <i class="fas fa-arrow-left"></i>
    </button>
</div>
            <h1 class="screen-title">¡JUEGO TERMINADO!</h1>
            <p class="screen-subtitle">
                🏆 Puntuación Final: <span id="finalScore">0</span><br>
                🎯 Nivel Alcanzado: <span id="finalLevel">1</span><br>
                ⭐ Mejor Combo: <span id="bestCombo">0</span>
            </p>
            <button class="game-button" onclick="restartGame()">
                <i class="fas fa-redo mr-2"></i>Jugar de Nuevo
            </button>
            <button class="game-button" onclick="goToMenu()">
                <i class="fas fa-home mr-2"></i>Menú Principal
            </button>
        </div>
        
        <!-- Pause Screen -->
        <div class="pause-screen hidden" id="pauseScreen">
            <h1 class="screen-title">PAUSA</h1>
            <p class="screen-subtitle">El juego está pausado</p>
            <button class="game-button" onclick="resumeGame()">
                <i class="fas fa-play mr-2"></i>Continuar
            </button>
            <button class="game-button" onclick="restartGame()">
                <i class="fas fa-redo mr-2"></i>Reiniciar
            </button>
            <button class="game-button" onclick="goToMenu()">
                <i class="fas fa-home mr-2"></i>Menú Principal
            </button>
        </div>
        
        <!-- Mobile Controls -->
        <div class="mobile-controls">
            <button class="mobile-btn" ontouchstart="moveLeft()" ontouchend="stopMove()">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="mobile-btn" ontouchstart="shoot()" style="background: rgba(255,107,53,0.3);">
                <i class="fas fa-magic"></i>
            </button>
            <button class="mobile-btn" ontouchstart="moveRight()" ontouchend="stopMove()">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            isPlaying: false,
            isPaused: false,
            score: 0,
            level: 1,
            health: 100,
            combo: 0,
            bestCombo: 0,
            enemies: [],
            collectibles: [],
            projectiles: [],
            powerUps: [],
            particles: []
        };

        // Game Objects
        let player = {
            x: window.innerWidth / 2,
            y: window.innerHeight - 200,
            width: 120,
            height: 160,
            speed: 8,
            element: null
        };

        // Game Settings
        const GAME_SETTINGS = {
            enemySpawnRate: 0.02,
            collectibleSpawnRate: 0.015,
            powerUpSpawnRate: 0.005,
            projectileSpeed: 12,
            enemySpeed: 3,
            maxEnemies: 8,
            maxCollectibles: 6,
            levelUpScore: 1000
        };

        // Initialize Game
        function initGame() {
            createPlayer();
            setupEventListeners();
            gameLoop();
        }

        function createPlayer() {
            player.element = document.createElement('div');
            player.element.className = 'character gueguense';
            player.element.style.left = player.x + 'px';
            player.element.style.top = player.y + 'px';
            document.getElementById('gameContainer').appendChild(player.element);
        }

        function setupEventListeners() {
            // Mouse controls
            document.addEventListener('mousemove', (e) => {
                if (gameState.isPlaying && !gameState.isPaused) {
                    player.x = Math.max(60, Math.min(window.innerWidth - 180, e.clientX - 60));
                    updatePlayerPosition();
                }
            });

            document.addEventListener('click', (e) => {
                if (gameState.isPlaying && !gameState.isPaused) {
                    shoot();
                }
            });

            // Keyboard controls
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (gameState.isPlaying) {
                        togglePause();
                    }
                }
            });

            // Touch controls
            document.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (gameState.isPlaying && !gameState.isPaused) {
                    const touch = e.touches[0];
                    player.x = Math.max(60, Math.min(window.innerWidth - 180, touch.clientX - 60));
                    updatePlayerPosition();
                }
            });

            document.addEventListener('touchstart', (e) => {
                if (gameState.isPlaying && !gameState.isPaused) {
                    shoot();
                }
            });

            // Window resize
            window.addEventListener('resize', () => {
                player.x = Math.max(60, Math.min(window.innerWidth - 180, player.x));
                updatePlayerPosition();
            });
        }

        function updatePlayerPosition() {
            if (player.element) {
                player.element.style.left = player.x + 'px';
            }
        }

        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            gameState.isPlaying = true;
            gameState.isPaused = false;
            resetGameState();
            playSound('start');
        }

        function resetGameState() {
            gameState.score = 0;
            gameState.level = 1;
            gameState.health = 100;
            gameState.combo = 0;
            gameState.enemies = [];
            gameState.collectibles = [];
            gameState.projectiles = [];
            gameState.powerUps = [];
            gameState.particles = [];
            
            // Clear existing game objects
            document.querySelectorAll('.enemy, .collectible, .projectile, .power-up, .explosion, .particle').forEach(el => el.remove());
            
            updateHUD();
        }

        function shoot() {
            if (!gameState.isPlaying || gameState.isPaused) return;
            
            const projectile = {
                x: player.x + player.width / 2,
                y: player.y,
                width: 20,
                height: 20,
                speed: GAME_SETTINGS.projectileSpeed,
                element: createProjectileElement()
            };
            
            gameState.projectiles.push(projectile);
            playSound('shoot');
        }

        function createProjectileElement() {
            const element = document.createElement('div');
            element.className = 'projectile';
            document.getElementById('gameContainer').appendChild(element);
            return element;
        }

        function spawnEnemy() {
            if (gameState.enemies.length >= GAME_SETTINGS.maxEnemies) return;
            
            const enemy = {
                x: Math.random() * (window.innerWidth - 120),
                y: -160,
                width: 120,
                height: 160,
                speed: GAME_SETTINGS.enemySpeed + (gameState.level - 1) * 0.5,
                health: 1,
                element: createEnemyElement()
            };
            
            gameState.enemies.push(enemy);
        }

        function createEnemyElement() {
            const element = document.createElement('div');
            element.className = 'character enemy';
            document.getElementById('gameContainer').appendChild(element);
            return element;
        }

        function spawnCollectible() {
            if (gameState.collectibles.length >= GAME_SETTINGS.maxCollectibles) return;
            
            const types = ['corn', 'mask'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            const collectible = {
                x: Math.random() * (window.innerWidth - 60),
                y: -60,
                width: 60,
                height: 60,
                speed: 2 + Math.random() * 2,
                type: type,
                value: type === 'mask' ? 200 : 100,
                element: createCollectibleElement(type)
            };
            
            gameState.collectibles.push(collectible);
        }

        function createCollectibleElement(type) {
            const element = document.createElement('div');
            element.className = `collectible ${type}`;
            document.getElementById('gameContainer').appendChild(element);
            return element;
        }

        function spawnPowerUp() {
            const powerUp = {
                x: Math.random() * (window.innerWidth - 80),
                y: -80,
                width: 80,
                height: 80,
                speed: 1.5,
                type: 'health',
                element: createPowerUpElement()
            };
            
            gameState.powerUps.push(powerUp);
        }

        function createPowerUpElement() {
            const element = document.createElement('div');
            element.className = 'power-up';
            document.getElementById('gameContainer').appendChild(element);
            return element;
        }

        function updateGame() {
            if (!gameState.isPlaying || gameState.isPaused) return;
            
            // Spawn objects
            if (Math.random() < GAME_SETTINGS.enemySpawnRate + (gameState.level - 1) * 0.005) {
                spawnEnemy();
            }
            
            if (Math.random() < GAME_SETTINGS.collectibleSpawnRate) {
                spawnCollectible();
            }
            
            if (Math.random() < GAME_SETTINGS.powerUpSpawnRate) {
                spawnPowerUp();
            }
            
            // Update projectiles
            gameState.projectiles.forEach((projectile, index) => {
                projectile.y -= projectile.speed;
                projectile.element.style.left = projectile.x + 'px';
                projectile.element.style.top = projectile.y + 'px';
                
                if (projectile.y < -20) {
                    projectile.element.remove();
                    gameState.projectiles.splice(index, 1);
                }
            });
            
            // Update enemies
            gameState.enemies.forEach((enemy, index) => {
                enemy.y += enemy.speed;
                enemy.element.style.left = enemy.x + 'px';
                enemy.element.style.top = enemy.y + 'px';
                
                if (enemy.y > window.innerHeight) {
                    enemy.element.remove();
                    gameState.enemies.splice(index, 1);
                }
                
                // Check collision with player
                if (checkCollision(player, enemy)) {
                    takeDamage(20);
                    createExplosion(enemy.x + enemy.width/2, enemy.y + enemy.height/2);
                    enemy.element.remove();
                    gameState.enemies.splice(index, 1);
                }
            });
            
            // Update collectibles
            gameState.collectibles.forEach((collectible, index) => {
                collectible.y += collectible.speed;
                collectible.element.style.left = collectible.x + 'px';
                collectible.element.style.top = collectible.y + 'px';
                
                if (collectible.y > window.innerHeight) {
                    collectible.element.remove();
                    gameState.collectibles.splice(index, 1);
                }
                
                // Check collision with player
                if (checkCollision(player, collectible)) {
                    collectItem(collectible);
                    collectible.element.remove();
                    gameState.collectibles.splice(index, 1);
                }
            });
            
            // Update power-ups
            gameState.powerUps.forEach((powerUp, index) => {
                powerUp.y += powerUp.speed;
                powerUp.element.style.left = powerUp.x + 'px';
                powerUp.element.style.top = powerUp.y + 'px';
                
                if (powerUp.y > window.innerHeight) {
                    powerUp.element.remove();
                    gameState.powerUps.splice(index, 1);
                }
                
                // Check collision with player
                if (checkCollision(player, powerUp)) {
                    usePowerUp(powerUp);
                    powerUp.element.remove();
                    gameState.powerUps.splice(index, 1);
                }
            });
            
            // Check projectile-enemy collisions
            gameState.projectiles.forEach((projectile, pIndex) => {
                gameState.enemies.forEach((enemy, eIndex) => {
                    if (checkCollision(projectile, enemy)) {
                        // Hit enemy
                        gameState.score += 50;
                        gameState.combo++;
                        
                        if (gameState.combo > gameState.bestCombo) {
                            gameState.bestCombo = gameState.combo;
                        }
                        
                        createExplosion(enemy.x + enemy.width/2, enemy.y + enemy.height/2);
                        showComboIndicator();
                        
                        // Remove projectile and enemy
                        projectile.element.remove();
                        enemy.element.remove();
                        gameState.projectiles.splice(pIndex, 1);
                        gameState.enemies.splice(eIndex, 1);
                        
                        playSound('hit');
                    }
                });
            });
            
            // Check level up
            if (gameState.score >= gameState.level * GAME_SETTINGS.levelUpScore) {
                levelUp();
            }
            
            updateHUD();
        }

        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + obj1.height > obj2.y;
        }

        function collectItem(collectible) {
            gameState.score += collectible.value;
            gameState.combo++;
            
            if (gameState.combo > gameState.bestCombo) {
                gameState.bestCombo = gameState.combo;
            }
            
            createParticles(collectible.x + collectible.width/2, collectible.y + collectible.height/2);
            showComboIndicator();
            playSound('collect');
        }

        function usePowerUp(powerUp) {
            if (powerUp.type === 'health') {
                gameState.health = Math.min(100, gameState.health + 30);
                playSound('powerup');
            }
        }

        function takeDamage(amount) {
            gameState.health -= amount;
            gameState.combo = 0; // Reset combo on damage
            
            if (gameState.health <= 0) {
                gameOver();
            }
            
            // Screen shake effect
            document.getElementById('gameContainer').style.animation = 'none';
            setTimeout(() => {
                document.getElementById('gameContainer').style.animation = '';
            }, 100);
            
            playSound('damage');
        }

        function levelUp() {
            gameState.level++;
            playSound('levelup');
            
            // Show level up indicator
            const indicator = document.createElement('div');
            indicator.className = 'combo-indicator';
            indicator.textContent = `¡NIVEL ${gameState.level}!`;
            indicator.style.color = '#00FF00';
            document.getElementById('gameContainer').appendChild(indicator);
            
            setTimeout(() => indicator.remove(), 1000);
        }

        function createExplosion(x, y) {
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.style.left = (x - 50) + 'px';
            explosion.style.top = (y - 50) + 'px';
            document.getElementById('gameContainer').appendChild(explosion);
            
            setTimeout(() => explosion.remove(), 600);
        }

        function createParticles(x, y) {
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.setProperty('--random-x', (Math.random() - 0.5) * 200 + 'px');
                particle.style.setProperty('--random-y', -Math.random() * 150 + 'px');
                document.getElementById('gameContainer').appendChild(particle);
                
                setTimeout(() => particle.remove(), 2000);
            }
        }

        function showComboIndicator() {
            if (gameState.combo > 1) {
                const indicator = document.createElement('div');
                indicator.className = 'combo-indicator';
                indicator.textContent = `COMBO x${gameState.combo}!`;
                document.getElementById('gameContainer').appendChild(indicator);
                
                setTimeout(() => indicator.remove(), 1000);
            }
        }

        function updateHUD() {
            document.getElementById('score').textContent = gameState.score.toLocaleString();
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('combo').textContent = gameState.combo;
            document.getElementById('healthFill').style.width = gameState.health + '%';
            
            // Change health bar color based on health
            const healthFill = document.getElementById('healthFill');
            if (gameState.health > 60) {
                healthFill.style.background = 'linear-gradient(90deg, #4ECDC4 0%, #44A08D 100%)';
            } else if (gameState.health > 30) {
                healthFill.style.background = 'linear-gradient(90deg, #FFD700 0%, #FFA500 100%)';
            } else {
                healthFill.style.background = 'linear-gradient(90deg, #FF4444 0%, #FF6B6B 100%)';
            }
        }

        function gameOver() {
            gameState.isPlaying = false;
            
            document.getElementById('finalScore').textContent = gameState.score.toLocaleString();
            document.getElementById('finalLevel').textContent = gameState.level;
            document.getElementById('bestCombo').textContent = gameState.bestCombo;
            
            document.getElementById('gameOverScreen').classList.remove('hidden');
            playSound('gameover');
        }

        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            
            if (gameState.isPaused) {
                document.getElementById('pauseScreen').classList.remove('hidden');
            } else {
                document.getElementById('pauseScreen').classList.add('hidden');
            }
        }

        function resumeGame() {
            gameState.isPaused = false;
            document.getElementById('pauseScreen').classList.add('hidden');
        }

        function restartGame() {
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('pauseScreen').classList.add('hidden');
            startGame();
        }

        function goToMenu() {
            gameState.isPlaying = false;
            gameState.isPaused = false;
            
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('pauseScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
            
            // Clear game objects
            document.querySelectorAll('.enemy, .collectible, .projectile, .power-up, .explosion, .particle, .combo-indicator').forEach(el => el.remove());
        }

        function showInstructions() {
            alert(`🎮 INSTRUCCIONES DEL JUEGO 🎮

🎯 OBJETIVO:
Ayuda al Güegüense a recolectar máscaras tradicionales (🎭) y maíz sagrado (🌽) mientras evitas a los espíritus malignos (👹).

🕹️ CONTROLES:
• 🖱️ Mueve el mouse para mover al Güegüense
• 🖱️ Haz clic para disparar magia dorada
• ⏸️ Presiona ESC para pausar
• 📱 En móvil: toca la pantalla para mover y disparar

⭐ PUNTUACIÓN:
• Maíz sagrado: 100 puntos
• Máscaras tradicionales: 200 puntos  
• Eliminar espíritus: 50 puntos
• ¡Mantén combos para más puntos!

💖 SALUD:
• Evita a los espíritus malignos
• Recolecta power-ups (⚡) para recuperar salud
• ¡No dejes que tu salud llegue a cero!

🏆 NIVELES:
• Cada 1000 puntos subes de nivel
• Los enemigos se vuelven más rápidos
• ¡Más desafío, más diversión!

¡Que comience la aventura cultural! 🇳🇮`);
        }

        // Mobile controls
        let moveDirection = 0;

        function moveLeft() {
            moveDirection = -1;
        }

        function moveRight() {
            moveDirection = 1;
        }

        function stopMove() {
            moveDirection = 0;
        }

        // Sound effects (simplified)
        function playSound(type) {
            // Create audio context for sound effects
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                switch(type) {
                    case 'shoot':
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                        break;
                    case 'hit':
                        oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.2);
                        break;
                    case 'collect':
                        oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.2);
                        break;
                    case 'powerup':
                        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.3);
                        break;
                    case 'damage':
                        oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
                        break;
                    case 'levelup':
                        oscillator.frequency.setValueAtTime(500, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(1000, audioContext.currentTime + 0.5);
                        break;
                }
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                // Fallback for browsers without audio context
                console.log('Sound:', type);
            }
        }

        // Game loop
        function gameLoop() {
            updateGame();
            
            // Handle mobile movement
            if (moveDirection !== 0 && gameState.isPlaying && !gameState.isPaused) {
                player.x += moveDirection * player.speed;
                player.x = Math.max(60, Math.min(window.innerWidth - 180, player.x));
                updatePlayerPosition();
            }
            
            requestAnimationFrame(gameLoop);
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', initGame);
        // Función para regresar al menú de juegos del principal
function goBackToGames() {
    window.location.href = "principal.html#games-section";
}

// Opcional: Oculta la flecha cuando el juego está activo
function toggleBackArrow(showStart, showGameOver) {
    document.getElementById('back-arrow-start').style.display = showStart ? '' : 'none';
    document.getElementById('back-arrow-gameover').style.display = showGameOver ? '' : 'none';
}

// Lógica para mostrar/ocultar flechas según pantalla
document.addEventListener('DOMContentLoaded', function() {
    // Al iniciar, solo mostrar en pantalla de inicio
    toggleBackArrow(true, false);

    // Cuando inicia el juego, ocultar flecha de inicio
    window.startGame = function() {
        document.getElementById('startScreen').classList.add('hidden');
        toggleBackArrow(false, false);
        gameState.isPlaying = true;
        gameState.isPaused = false;
        resetGameState();
        playSound('start');
    };

    // Cuando termina el juego, mostrar flecha en game over
    window.gameOver = function() {
        gameState.isPlaying = false;
        document.getElementById('finalScore').textContent = gameState.score.toLocaleString();
        document.getElementById('finalLevel').textContent = gameState.level;
        document.getElementById('bestCombo').textContent = gameState.bestCombo;
        document.getElementById('gameOverScreen').classList.remove('hidden');
        toggleBackArrow(false, true);
        playSound('gameover');
    };

    // Cuando regresas al menú principal desde game over
    window.goToMenu = function() {
        gameState.isPlaying = false;
        gameState.isPaused = false;
        document.getElementById('gameOverScreen').classList.add('hidden');
        document.getElementById('pauseScreen').classList.add('hidden');
        document.getElementById('startScreen').classList.remove('hidden');
        toggleBackArrow(true, false);
        document.querySelectorAll('.enemy, .collectible, .projectile, .power-up, .explosion, .particle, .combo-indicator').forEach(el => el.remove());
    };
});
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97c731cf14ca6d5c',t:'MTc1NzQyNjI0NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
